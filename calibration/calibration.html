<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Peter Flach">

<title>Quarto Simple Example - Classifier Calibration</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Classifier Calibration</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Quarto Simple Example</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">Home</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../calibration/calibration.html" class="sidebar-item-text sidebar-link active">Classifier Calibration</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../about.html" class="sidebar-item-text sidebar-link">About</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#taking-inspiration-from-forecasting" id="toc-taking-inspiration-from-forecasting" class="nav-link active" data-scroll-target="#taking-inspiration-from-forecasting">Taking inspiration from forecasting</a>
  <ul class="collapse">
  <li><a href="#weather-forecasters" id="toc-weather-forecasters" class="nav-link" data-scroll-target="#weather-forecasters">Weather forecasters</a></li>
  <li><a href="#forecasting-example" id="toc-forecasting-example" class="nav-link" data-scroll-target="#forecasting-example">Forecasting example</a></li>
  <li><a href="#over--and-under-estimates" id="toc-over--and-under-estimates" class="nav-link" data-scroll-target="#over--and-under-estimates">Over- and under-estimates</a></li>
  <li><a href="#visualising-forecasts-the-reliability-diagram" id="toc-visualising-forecasts-the-reliability-diagram" class="nav-link" data-scroll-target="#visualising-forecasts-the-reliability-diagram">Visualising forecasts: the reliability diagram</a></li>
  <li><a href="#changing-the-numbers-slightly" id="toc-changing-the-numbers-slightly" class="nav-link" data-scroll-target="#changing-the-numbers-slightly">Changing the numbers slightly</a></li>
  <li><a href="#or-should-we-group-the-forecasts-differently" id="toc-or-should-we-group-the-forecasts-differently" class="nav-link" data-scroll-target="#or-should-we-group-the-forecasts-differently">Or should we group the forecasts differently?</a></li>
  <li><a href="#or-not-at-all" id="toc-or-not-at-all" class="nav-link" data-scroll-target="#or-not-at-all">Or not at all?</a></li>
  <li><a href="#binning-or-pooling-predictions-is-a-fundamental-notion" id="toc-binning-or-pooling-predictions-is-a-fundamental-notion" class="nav-link" data-scroll-target="#binning-or-pooling-predictions-is-a-fundamental-notion">Binning or pooling predictions is a fundamental notion</a></li>
  <li><a href="#questions-and-answers" id="toc-questions-and-answers" class="nav-link" data-scroll-target="#questions-and-answers">Questions and answers</a>
  <ul class="collapse">
  <li><a href="#qa-1" id="toc-qa-1" class="nav-link" data-scroll-target="#qa-1">Q&amp;A 1</a></li>
  <li><a href="#qa-2" id="toc-qa-2" class="nav-link" data-scroll-target="#qa-2">Q&amp;A 2</a></li>
  <li><a href="#qa-3" id="toc-qa-3" class="nav-link" data-scroll-target="#qa-3">Q&amp;A 3</a></li>
  <li><a href="#qa-4" id="toc-qa-4" class="nav-link" data-scroll-target="#qa-4">Q&amp;A 4</a></li>
  <li><a href="#qa-5" id="toc-qa-5" class="nav-link" data-scroll-target="#qa-5">Q&amp;A 5</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#why-are-we-interested-in-calibration" id="toc-why-are-we-interested-in-calibration" class="nav-link" data-scroll-target="#why-are-we-interested-in-calibration">Why are we interested in calibration?</a>
  <ul class="collapse">
  <li><a href="#why-are-we-interested-in-calibration-1" id="toc-why-are-we-interested-in-calibration-1" class="nav-link" data-scroll-target="#why-are-we-interested-in-calibration-1">Why are we interested in calibration?</a></li>
  <li><a href="#optimal-decisions-i" id="toc-optimal-decisions-i" class="nav-link" data-scroll-target="#optimal-decisions-i">Optimal decisions I</a></li>
  <li><a href="#optimal-decisions-ii" id="toc-optimal-decisions-ii" class="nav-link" data-scroll-target="#optimal-decisions-ii">Optimal decisions II</a></li>
  <li><a href="#optimal-decisions-iii" id="toc-optimal-decisions-iii" class="nav-link" data-scroll-target="#optimal-decisions-iii">Optimal decisions III</a></li>
  <li><a href="#questions-and-answers-1" id="toc-questions-and-answers-1" class="nav-link" data-scroll-target="#questions-and-answers-1">Questions and answers</a>
  <ul class="collapse">
  <li><a href="#qa-1-1" id="toc-qa-1-1" class="nav-link" data-scroll-target="#qa-1-1">Q&amp;A 1</a></li>
  <li><a href="#qa-2-1" id="toc-qa-2-1" class="nav-link" data-scroll-target="#qa-2-1">Q&amp;A 2</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#common-sources-of-miscalibration" id="toc-common-sources-of-miscalibration" class="nav-link" data-scroll-target="#common-sources-of-miscalibration">Common sources of miscalibration</a>
  <ul class="collapse">
  <li><a href="#common-sources-of-miscalibration-1" id="toc-common-sources-of-miscalibration-1" class="nav-link" data-scroll-target="#common-sources-of-miscalibration-1">Common sources of miscalibration</a></li>
  <li><a href="#underconfidence-example" id="toc-underconfidence-example" class="nav-link" data-scroll-target="#underconfidence-example">Underconfidence example</a></li>
  <li><a href="#overconfidence-example" id="toc-overconfidence-example" class="nav-link" data-scroll-target="#overconfidence-example">Overconfidence example</a></li>
  <li><a href="#why-fitting-the-distortions-helps-with-calibration" id="toc-why-fitting-the-distortions-helps-with-calibration" class="nav-link" data-scroll-target="#why-fitting-the-distortions-helps-with-calibration">Why fitting the distortions helps with calibration</a></li>
  <li><a href="#questions-and-answers-2" id="toc-questions-and-answers-2" class="nav-link" data-scroll-target="#questions-and-answers-2">Questions and answers</a>
  <ul class="collapse">
  <li><a href="#qa-1-2" id="toc-qa-1-2" class="nav-link" data-scroll-target="#qa-1-2">Q&amp;A 1</a></li>
  <li><a href="#qa-2-2" id="toc-qa-2-2" class="nav-link" data-scroll-target="#qa-2-2">Q&amp;A 2</a></li>
  <li><a href="#qa-3-1" id="toc-qa-3-1" class="nav-link" data-scroll-target="#qa-3-1">Q&amp;A 3</a></li>
  <li><a href="#qa-4-1" id="toc-qa-4-1" class="nav-link" data-scroll-target="#qa-4-1">Q&amp;A 4</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#a-first-look-at-some-calibration-techniques" id="toc-a-first-look-at-some-calibration-techniques" class="nav-link" data-scroll-target="#a-first-look-at-some-calibration-techniques">A first look at some calibration techniques</a>
  <ul class="collapse">
  <li><a href="#a-first-look-at-some-calibration-techniques-1" id="toc-a-first-look-at-some-calibration-techniques-1" class="nav-link" data-scroll-target="#a-first-look-at-some-calibration-techniques-1">A first look at some calibration techniques</a></li>
  <li><a href="#platt-scaling" id="toc-platt-scaling" class="nav-link" data-scroll-target="#platt-scaling">Platt scaling</a></li>
  <li><a href="#beta-calibration" id="toc-beta-calibration" class="nav-link" data-scroll-target="#beta-calibration">Beta calibration</a></li>
  <li><a href="#isotonic-regression" id="toc-isotonic-regression" class="nav-link" data-scroll-target="#isotonic-regression">Isotonic regression</a></li>
  <li><a href="#questions-and-answers-3" id="toc-questions-and-answers-3" class="nav-link" data-scroll-target="#questions-and-answers-3">Questions and answers</a></li>
  </ul></li>
  <li><a href="#calibrating-multi-class-classifiers" id="toc-calibrating-multi-class-classifiers" class="nav-link" data-scroll-target="#calibrating-multi-class-classifiers">Calibrating multi-class classifiers</a>
  <ul class="collapse">
  <li><a href="#whats-so-special-about-multi-class-calibration" id="toc-whats-so-special-about-multi-class-calibration" class="nav-link" data-scroll-target="#whats-so-special-about-multi-class-calibration">What’s so special about multi-class calibration?</a></li>
  <li><a href="#definitions-of-calibration-for-more-than-two-classes" id="toc-definitions-of-calibration-for-more-than-two-classes" class="nav-link" data-scroll-target="#definitions-of-calibration-for-more-than-two-classes">Definitions of calibration for more than two classes</a></li>
  <li><a href="#confidence-calibration" id="toc-confidence-calibration" class="nav-link" data-scroll-target="#confidence-calibration">Confidence calibration</a></li>
  <li><a href="#class-wise-calibration" id="toc-class-wise-calibration" class="nav-link" data-scroll-target="#class-wise-calibration">Class-wise calibration</a></li>
  <li><a href="#multi-class-calibration" id="toc-multi-class-calibration" class="nav-link" data-scroll-target="#multi-class-calibration">Multi-class calibration</a></li>
  <li><a href="#reminder-binning-needed" id="toc-reminder-binning-needed" class="nav-link" data-scroll-target="#reminder-binning-needed">Reminder: binning needed</a></li>
  <li><a href="#important-points-to-remember" id="toc-important-points-to-remember" class="nav-link" data-scroll-target="#important-points-to-remember">Important points to remember</a></li>
  <li><a href="#questions-and-answers-4" id="toc-questions-and-answers-4" class="nav-link" data-scroll-target="#questions-and-answers-4">Questions and answers</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/perellonieto/quarto_simple_example/edit/main/calibration/calibration.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/perellonieto/quarto_simple_example/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Classifier Calibration</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    Peter Flach <a href="https://orcid.org/0000-0001-6857-5810" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of Bristol
          </p>
      </div>
      <div class="quarto-title-meta-contents">
    Miquel Perello Nieto <a href="https://orcid.org/0000-0001-8925-424X" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of Bristol
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  

</header>

<div>
<p><a href="../slides/calibration/calibration.html" target="_blank"><img src="https://img.shields.io/badge/slides-calibration-yellow"></a></p>
</div>
<section id="taking-inspiration-from-forecasting" class="level1">
<h1>Taking inspiration from forecasting</h1>
<iframe allowfullscreen="" src="https://media.upv.es/player/embed.html?id=003597b0-bf29-11ed-83a4-bf04f88f22c5" style="border:0px #FFFFFF none;" name="Paella Player" scrolling="no" frameborder="0" marginheight="0px" marginwidth="0px" width="640" height="360">
</iframe>
<section id="weather-forecasters" class="level2">
<h2 class="anchored" data-anchor-id="weather-forecasters">Weather forecasters</h2>
<ul>
<li>Weather forecasters started thinking about calibration a long time ago <span class="citation" data-cites="brier1950">(<a href="#ref-brier1950" role="doc-biblioref">Brier 1950</a>)</span>.
<ul>
<li>A forecast <code>70% chance of rain</code> should be followed by rain 70% of the time.</li>
</ul></li>
<li>This is immediately applicable to binary classification:
<ul>
<li>A prediction <code>70% chance of spam</code> should be spam 70% of the time.</li>
</ul></li>
<li>and to multi-class classification:
<ul>
<li>A prediction <code>70% chance of setosa, 10% chance of versicolor and 20% chance of virginica</code> should be setosa/versicolor/virginica 70/10/20% of the time.</li>
</ul></li>
<li>In general:
<ul>
<li>A predicted probability (vector) should match empirical (observed) probabilities.</li>
</ul></li>
</ul>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
<strong>Q:</strong> What does <code>X% of the time</code> mean?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>It means that we expect the occurrence of an event to happen “X%” of the time.</p>
</div>
</div>
</div>
</section>
<section id="forecasting-example" class="level2">
<h2 class="anchored" data-anchor-id="forecasting-example">Forecasting example</h2>
<p>Let’s consider a small toy example:</p>
<ul>
<li>Two predictions of <code>10% chance of rain</code> were both followed by <code>no rain</code>.</li>
<li>Two predictions of <code>40% chance of rain</code> were once followed by <code>no rain</code>, and once by <code>rain</code>.</li>
<li>Three predictions of <code>70% chance of rain</code> were once followed by <code>no rain</code>, and twice by <code>rain</code>.</li>
<li>One prediction of <code>90% chance of rain</code> was followed by <code>rain</code>.</li>
</ul>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
<strong>Q:</strong> Is this forecaster well-calibrated?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The evaluation of calibration requires a large number of samples to make a statement. However, in this toy example we can assume that a <span class="math inline">10\%</span> discrepancy is acceptable, and that the number of samples is sufficient.</p>
</div>
</div>
</div>
</section>
<section id="over--and-under-estimates" class="level2">
<h2 class="anchored" data-anchor-id="over--and-under-estimates">Over- and under-estimates</h2>
<div class="columns v-center-container">
<div class="column" style="width:20%;">
<table class="table">
<colgroup>
<col style="width: 8%">
<col style="width: 16%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><span class="math inline">\hat{p}</span></th>
<th><span class="math inline">y</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0<br>
1</td>
<td>0.1<br>
0.1</td>
<td>0<br>
0</td>
</tr>
<tr class="even">
<td>2<br>
3</td>
<td>0.4<br>
0.4</td>
<td>0<br>
1</td>
</tr>
<tr class="odd">
<td>4<br>
5<br>
6</td>
<td>0.7<br>
0.7<br>
0.7</td>
<td>0<br>
1<br>
1</td>
</tr>
<tr class="even">
<td>7</td>
<td>0.9</td>
<td>1</td>
</tr>
</tbody>
</table>
</div><div class="column" style="width:10%;">

</div><div class="column v-center-container" style="width:70%;">
<p>This forecaster is doing a pretty decent job:</p>
<ul>
<li><code>10% chance of rain</code> was a slight over-estimate<br>
(<span class="math inline">\bar{y} = 0/2 = 0\%</span>);</li>
<li><code>40% chance of rain</code> was a slight under-estimate<br>
(<span class="math inline">\bar{y} = 1/2 = 50\%</span>);</li>
<li><code>70% chance of rain</code> was a slight over-estimate<br>
(<span class="math inline">\bar{y} = 2/3 = 67\%</span>);</li>
<li><code>90% chance of rain</code> was a slight under-estimate<br>
(<span class="math inline">\bar{y} = 1/1 = 100\%</span>).</li>
</ul>
</div>
</div>
</section>
<section id="visualising-forecasts-the-reliability-diagram" class="level2">
<h2 class="anchored" data-anchor-id="visualising-forecasts-the-reliability-diagram">Visualising forecasts: the reliability diagram</h2>
<div class="columns v-center-container">
<div class="column" style="width:20%;">
<table class="table">
<colgroup>
<col style="width: 8%">
<col style="width: 16%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><span class="math inline">\hat{p}</span></th>
<th><span class="math inline">y</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0<br>
1</td>
<td>0.1<br>
0.1</td>
<td>0<br>
0</td>
</tr>
<tr class="even">
<td>2<br>
3</td>
<td>0.4<br>
0.4</td>
<td>0<br>
1</td>
</tr>
<tr class="odd">
<td>4<br>
5<br>
6</td>
<td>0.7<br>
0.7<br>
0.7</td>
<td>0<br>
1<br>
1</td>
</tr>
<tr class="even">
<td>7</td>
<td>0.9</td>
<td>1</td>
</tr>
</tbody>
</table>
</div><div class="column" style="width:10%;">

</div><div class="column v-center-container" style="width:70%;">
<div class="cell" data-execution_count="1">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pycalib.visualisations <span class="im">import</span> plot_reliability_diagram</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> np.array([<span class="fl">0.1</span>, <span class="fl">0.1</span> ,<span class="fl">0.4</span>, <span class="fl">0.4</span>,<span class="fl">0.7</span>, <span class="fl">0.7</span>, <span class="fl">0.7</span>, <span class="fl">0.9</span>])</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>bins <span class="op">=</span> [<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.85</span>, <span class="fl">1.0</span>]</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">4</span>))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plot_reliability_diagram(labels, np.vstack([<span class="dv">1</span> <span class="op">-</span> scores, scores]).T,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>                               class_names<span class="op">=</span>[<span class="st">'not 1'</span>, <span class="st">'rain'</span>], bins<span class="op">=</span>bins,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>                               fig<span class="op">=</span>fig, show_gaps<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>                               show_bars<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="calibration_files/figure-html/cell-2-output-1.png" width="439" height="361"></p>
</div>
</div>
</div>
</div>
</section>
<section id="changing-the-numbers-slightly" class="level2">
<h2 class="anchored" data-anchor-id="changing-the-numbers-slightly">Changing the numbers slightly</h2>
<div class="columns v-center-container">
<div class="column" style="width:20%;">
<table class="table">
<colgroup>
<col style="width: 8%">
<col style="width: 16%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><span class="math inline">\hat{p}</span></th>
<th><span class="math inline">y</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0<br>
1</td>
<td>0.1<br>
0.2</td>
<td>0<br>
0</td>
</tr>
<tr class="even">
<td>2<br>
3</td>
<td>0.3<br>
0.4</td>
<td>0<br>
1</td>
</tr>
<tr class="odd">
<td>4<br>
5<br>
6</td>
<td>0.6<br>
0.7<br>
0.8</td>
<td>0<br>
1<br>
1</td>
</tr>
<tr class="even">
<td>7</td>
<td>0.9</td>
<td>1</td>
</tr>
</tbody>
</table>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:70%;">
<div class="cell" data-execution_count="2">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pycalib.visualisations <span class="im">import</span> plot_reliability_diagram</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> np.array([<span class="fl">0.1</span>, <span class="fl">0.2</span> ,<span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>])</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>bins <span class="op">=</span> [<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.85</span>, <span class="fl">1.0</span>]</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">4</span>))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plot_reliability_diagram(labels, np.vstack([<span class="dv">1</span> <span class="op">-</span> scores, scores]).T,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>                               class_names<span class="op">=</span>[<span class="st">'not 1'</span>, <span class="st">'rain'</span>], bins<span class="op">=</span>bins,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>                               fig<span class="op">=</span>fig, show_gaps<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>                               show_bars<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="calibration_files/figure-html/cell-3-output-1.png" width="439" height="361"></p>
</div>
</div>
</div>
</div>
</section>
<section id="or-should-we-group-the-forecasts-differently" class="level2">
<h2 class="anchored" data-anchor-id="or-should-we-group-the-forecasts-differently">Or should we group the forecasts differently?</h2>
<div class="columns v-center-container">
<div class="column" style="width:20%;">
<table class="table">
<colgroup>
<col style="width: 8%">
<col style="width: 16%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><span class="math inline">\hat{p}</span></th>
<th><span class="math inline">y</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0<br>
1<br>
2<br>
3</td>
<td>0.1<br>
0.2<br>
0.3<br>
0.4</td>
<td>0<br>
0<br>
0<br>
1</td>
</tr>
<tr class="even">
<td>4<br>
5<br>
6<br>
7</td>
<td>0.6<br>
0.7<br>
0.8<br>
0.9</td>
<td>0<br>
1<br>
1<br>
1</td>
</tr>
</tbody>
</table>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:70%;">
<div class="cell" data-execution_count="3">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pycalib.visualisations <span class="im">import</span> plot_reliability_diagram</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> np.array([<span class="fl">0.1</span>, <span class="fl">0.2</span> ,<span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>])</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>bins <span class="op">=</span> [<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="fl">1.0</span>]</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">4</span>))</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plot_reliability_diagram(labels, np.vstack([<span class="dv">1</span> <span class="op">-</span> scores, scores]).T,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>                               class_names<span class="op">=</span>[<span class="st">'not 1'</span>, <span class="st">'rain'</span>], bins<span class="op">=</span>bins,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>                               fig<span class="op">=</span>fig, show_gaps<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>                               show_bars<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="calibration_files/figure-html/cell-4-output-1.png" width="439" height="361"></p>
</div>
</div>
</div>
</div>
</section>
<section id="or-not-at-all" class="level2">
<h2 class="anchored" data-anchor-id="or-not-at-all">Or not at all?</h2>
<div class="columns v-center-container">
<div class="column" style="width:20%;">
<table class="table">
<colgroup>
<col style="width: 8%">
<col style="width: 16%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><span class="math inline">\hat{p}</span></th>
<th><span class="math inline">y</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0.1</td>
<td>0</td>
</tr>
<tr class="even">
<td>1</td>
<td>0.2</td>
<td>0</td>
</tr>
<tr class="odd">
<td>2</td>
<td>0.3</td>
<td>0</td>
</tr>
<tr class="even">
<td>3</td>
<td>0.4</td>
<td>1</td>
</tr>
<tr class="odd">
<td>4</td>
<td>0.6</td>
<td>0</td>
</tr>
<tr class="even">
<td>5</td>
<td>0.7</td>
<td>1</td>
</tr>
<tr class="odd">
<td>6</td>
<td>0.8</td>
<td>1</td>
</tr>
<tr class="even">
<td>7</td>
<td>0.9</td>
<td>1</td>
</tr>
</tbody>
</table>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:70%;">
<div class="cell" data-execution_count="4">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pycalib.visualisations <span class="im">import</span> plot_reliability_diagram</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> np.array([<span class="fl">0.1</span>, <span class="fl">0.2</span> ,<span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>])</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>bins <span class="op">=</span> [<span class="dv">0</span>, <span class="fl">0.101</span>, <span class="fl">0.201</span>, <span class="fl">0.301</span>, <span class="fl">0.401</span>, <span class="fl">0.601</span>, <span class="fl">0.701</span>, <span class="fl">0.801</span>, <span class="fl">0.901</span>, <span class="fl">1.0</span>]</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">4</span>))</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plot_reliability_diagram(labels, np.vstack([<span class="dv">1</span> <span class="op">-</span> scores, scores]).T,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                               class_names<span class="op">=</span>[<span class="st">'not 1'</span>, <span class="st">'rain'</span>], bins<span class="op">=</span>bins,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                               fig<span class="op">=</span>fig, show_gaps<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                               show_bars<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="calibration_files/figure-html/cell-5-output-1.png" width="439" height="361"></p>
</div>
</div>
</div>
</div>
</section>
<section id="binning-or-pooling-predictions-is-a-fundamental-notion" class="level2">
<h2 class="anchored" data-anchor-id="binning-or-pooling-predictions-is-a-fundamental-notion">Binning or pooling predictions is a fundamental notion</h2>
<p>We need bins to <strong>evaluate</strong> the degree of calibration:</p>
<ul>
<li>In order to decide whether a weather forecaster is well-calibrated, we need to look at a good number of forecasts, say over one year.</li>
<li>We also need to make sure that there are a reasonable number of forecasts for separate probability values, so we can obtain reliable empirical estimates.
<ul>
<li>Trade-off: large bins give better empirical estimates, small bins allows a more fine-grained assessment of calibration.}</li>
</ul></li>
</ul>
<p>But adjusting forecasts in groups also gives rise to practical calibration <strong>methods</strong>:</p>
<ul>
<li>empirical binning</li>
<li>isotonic regression (aka ROC convex hull)</li>
</ul>
</section>
<section id="questions-and-answers" class="level2">
<h2 class="anchored" data-anchor-id="questions-and-answers">Questions and answers</h2>
<section id="qa-1" class="level3">
<h3 class="anchored" data-anchor-id="qa-1">Q&amp;A 1</h3>
<div class="columns v-center-container">
<div class="column" style="width:50%;">
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Question 1
</div>
</div>
<div class="callout-body-container callout-body">
<p>A binary classifier for weather predictions produces a score of 0.1 for rain two times but it does not rain, two times 0.4 and it rains only once, five times 0.6 and it rains 80% of the times and one time 0.9 and it rains. Does the following reliability diagram show that information?</p>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: Yes
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Correct</strong>. You can see that there is one bin per predicted score <span class="math inline">0.1, 0.4, 0.6</span> and <span class="math inline">0.9</span>. Each bin contains the number of scores indicated in the smaller histogram below with 2, 2, 5 and 1 samples respectively. Finally, the height of each bin corresponds to the fraction of rains indicated in the question 0%, 50%, 80% and 100%.</p>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: No
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Incorrect</strong>. Try another answer.</p>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-execution_count="5">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pycalib.visualisations <span class="im">import</span> plot_reliability_diagram</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> np.array([<span class="dv">0</span>,   <span class="dv">0</span>,  <span class="dv">0</span>,  <span class="dv">1</span>,  <span class="dv">0</span>,  <span class="dv">1</span>,  <span class="dv">1</span>,  <span class="dv">1</span>,  <span class="dv">1</span>,  <span class="dv">1</span>])</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> np.array([<span class="fl">.1</span>, <span class="fl">.1</span>, <span class="fl">.4</span>, <span class="fl">.4</span>, <span class="fl">.6</span>, <span class="fl">.6</span>, <span class="fl">.6</span>, <span class="fl">.6</span>, <span class="fl">.6</span>, <span class="fl">.9</span>])</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">3</span>))</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plot_reliability_diagram(labels, np.vstack([<span class="dv">1</span> <span class="op">-</span> scores, scores]).T,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>                               class_names<span class="op">=</span>[<span class="st">'not 1'</span>, <span class="st">'rain'</span>], bins<span class="op">=</span><span class="dv">4</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>                               fig<span class="op">=</span>fig,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>                               hist_per_class<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>                               show_bars<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>                               show_gaps<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="calibration_files/figure-html/cell-6-output-1.png" width="439" height="287"></p>
</div>
</div>
</div>
</div>
</section>
<section id="qa-2" class="level3">
<h3 class="anchored" data-anchor-id="qa-2">Q&amp;A 2</h3>
<div class="columns v-center-container">
<div class="column" style="width:50%;">
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Question 2
</div>
</div>
<div class="callout-body-container callout-body">
<p>A binary classifier for weather predictions produces a score of 0.1 for rain two times and it rains once, three times 0.4 and it rains two times, four times 0.6 and it rains once and one time 0.9 and it rains. Does the following reliability diagram show that information?</p>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: Yes
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Correct</strong>. You can see that there is one bin per predicted score <span class="math inline">0.1, 0.4, 0.6</span> and 0.9. Each bin contains the number of scores indicated in the smaller histogram below with 2, 3, 4 and 1 samples respectively. Finally, the height of each bin corresponds to the fraction of rains indicated in the question 50%, 66.6%, 25% and 100%.</p>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: No
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Incorrect</strong>. Try another answer.</p>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-execution_count="6">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> np.array([<span class="dv">0</span>,   <span class="dv">1</span>,  <span class="dv">0</span>,  <span class="dv">1</span>,  <span class="dv">1</span>,  <span class="dv">0</span>,  <span class="dv">0</span>,  <span class="dv">0</span>,  <span class="dv">1</span>,  <span class="dv">1</span>])</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> np.array([<span class="fl">.1</span>, <span class="fl">.1</span>, <span class="fl">.4</span>, <span class="fl">.4</span>, <span class="fl">.4</span>, <span class="fl">.6</span>, <span class="fl">.6</span>, <span class="fl">.6</span>, <span class="fl">.6</span>, <span class="fl">.9</span>])</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">3</span>))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plot_reliability_diagram(labels, np.vstack([<span class="dv">1</span> <span class="op">-</span> scores, scores]).T,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                               class_names<span class="op">=</span>[<span class="st">'not 1'</span>, <span class="st">'rain'</span>], bins<span class="op">=</span><span class="dv">4</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                               fig<span class="op">=</span>fig,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                               hist_per_class<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                               show_bars<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                               show_gaps<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="calibration_files/figure-html/cell-7-output-1.png" width="439" height="287"></p>
</div>
</div>
</div>
</div>
</section>
<section id="qa-3" class="level3">
<h3 class="anchored" data-anchor-id="qa-3">Q&amp;A 3</h3>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Question 3
</div>
</div>
<div class="callout-body-container callout-body">
<p>Do we need multiple instances in each bin in order to visualise a reliability diagram?</p>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: Yes
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Incorrect</strong>. Try another answer.</p>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: No
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Correct</strong>. It is not necessary to have multiple instances in each bin for visualisation purposes. However, the lack of information does not allow us to know if the model is calibrated for those scores.</p>
</div>
</div>
</div>
</section>
<section id="qa-4" class="level3">
<h3 class="anchored" data-anchor-id="qa-4">Q&amp;A 4</h3>
<div class="columns v-center-container">
<div class="column" style="width:50%;">
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Question 4
</div>
</div>
<div class="callout-body-container callout-body">
<p>The following figure shows the reliability diagram of a binary classifier on enough samples to be statistically significant. Is the model calibrated, producing under-estimates or over-estimates?</p>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: Over-estimates
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Incorrect</strong>. Try another answer.</p>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: Under-estimates
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Correct</strong>. For each predicted score the actual fraction of positives is higher.</p>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-execution_count="7">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pycalib.visualisations <span class="im">import</span> plot_reliability_diagram_precomputed</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="fl">.1</span>, <span class="fl">.3</span>, <span class="fl">.6</span>, <span class="fl">.8</span>, <span class="dv">1</span>]).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>empirical <span class="op">=</span> np.array([<span class="fl">.1</span>, <span class="fl">.2</span>, <span class="fl">.5</span>, <span class="fl">.7</span>, <span class="fl">.9</span>, <span class="dv">1</span>]).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">4</span>))</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plot_reliability_diagram_precomputed(avg_true<span class="op">=</span>empirical, avg_pred<span class="op">=</span>scores,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                               class_names<span class="op">=</span>[<span class="st">'rain'</span>],</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                               fig<span class="op">=</span>fig, show_gaps<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="calibration_files/figure-html/cell-8-output-1.png" width="439" height="361"></p>
</div>
</div>
</div>
</div>
</section>
<section id="qa-5" class="level3">
<h3 class="anchored" data-anchor-id="qa-5">Q&amp;A 5</h3>
<div class="columns v-center-container">
<div class="column" style="width:50%;">
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Question 5
</div>
</div>
<div class="callout-body-container callout-body">
<p>The following figure shows the reliability diagram of a binary classifier on enough samples to be statistically significant. Is the model calibrated, producing under-estimates or over-estimates?</p>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: Over-estimates
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Correct</strong>. For each predicted score the actual fraction of positives is lower.</p>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-17-contents" aria-controls="callout-17" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: Under-estimates
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-17" class="callout-17-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Incorrect</strong>. Try another answer.</p>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-execution_count="8">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pycalib.visualisations <span class="im">import</span> plot_reliability_diagram_precomputed</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="fl">.1</span>, <span class="fl">.3</span>, <span class="fl">.5</span>, <span class="fl">.7</span>, <span class="fl">.8</span>, <span class="fl">.9</span>, <span class="dv">1</span>]).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>empirical <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="fl">.05</span>, <span class="fl">.1</span>, <span class="fl">.3</span>, <span class="fl">.33</span>, <span class="fl">.6</span>, <span class="fl">.8</span>, <span class="dv">1</span>]).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">4</span>))</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plot_reliability_diagram_precomputed(avg_true<span class="op">=</span>empirical, avg_pred<span class="op">=</span>scores,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                               class_names<span class="op">=</span>[<span class="st">'rain'</span>],</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>                               fig<span class="op">=</span>fig, show_gaps<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="calibration_files/figure-html/cell-9-output-1.png" width="439" height="361"></p>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="why-are-we-interested-in-calibration" class="level1">
<h1>Why are we interested in calibration?</h1>
<iframe allowfullscreen="" src="https://media.upv.es/player/embed.html?id=2a1113c0-bf29-11ed-83a4-bf04f88f22c5" style="border:0px #FFFFFF none;" name="Paella Player" scrolling="no" frameborder="0" marginheight="0px" marginwidth="0px" width="640" height="360">
</iframe>
<section id="why-are-we-interested-in-calibration-1" class="level2">
<h2 class="anchored" data-anchor-id="why-are-we-interested-in-calibration-1">Why are we interested in calibration?</h2>
<p>To calibrate means <strong>to employ a known scale with known properties</strong>.</p>
<ul>
<li>E.g., additive scale with a well-defined zero, so that ratios are meaningful.</li>
</ul>
<p>For classifiers we want to use the probability scale, so that we can</p>
<ul>
<li>justifiably use default decision rules (e.g., maximum posterior probability);</li>
<li>adjust these decision rules in a straightforward way to account for different class priors or misclassification costs;</li>
<li>combine probability estimates in a well-founded way.</li>
</ul>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Q: Is the probability scale additive?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In some situations we may want to sum probabilities, for example if we have a set of mutually exclusive events, the probability of at least one of them happening can be computed by their sum. In other situations the product of probabilities is used, e.g.&nbsp;the probability of two independent events happening at the same time.</p>
</div>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-19-contents" aria-controls="callout-19" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
<strong>Q:</strong> How would you combine probability estimates from several well-calibrated models?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-19" class="callout-19-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Check some online information e.g. <a href="https://forum.effectivealtruism.org/posts/sMjcjnnpoAQCcedL2/when-pooling-forecasts-use-the-geometric-mean-of-odds#:~:text=Whereas%20the%20arithmetic%20mean%20adds,(1%E2%88%92p).%5B">When pooling forecasts, use the geometric mean of odds</a></p>
<p>And the following code shows some examples.</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="9">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tabulate <span class="im">import</span> tabulate</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Markdown</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mean(p):</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''Arithmetic mean'''</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> np.array(p)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.<span class="bu">sum</span>(p)<span class="op">/</span>(<span class="bu">len</span>(p))</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gmean(p):</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''Geometric mean'''</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> np.array(p)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    o <span class="op">=</span> np.power(np.prod(p<span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>p)), <span class="dv">1</span><span class="op">/</span><span class="bu">len</span>(p))</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> o<span class="op">/</span>(<span class="dv">1</span><span class="op">+</span>o)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hmean(p):</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''Harmonic mean'''</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> np.array(p)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">len</span>(p)<span class="op">/</span>np.<span class="bu">sum</span>(<span class="dv">1</span><span class="op">/</span>p)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>example_list <span class="op">=</span> [[<span class="fl">.1</span>, <span class="fl">.1</span>], [<span class="fl">.5</span>, <span class="fl">.5</span>], [<span class="fl">.1</span>, <span class="fl">.9</span>],</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>                [<span class="fl">.1</span>, <span class="fl">.1</span>, <span class="fl">.9</span>], [<span class="fl">.1</span>, <span class="fl">.1</span>, <span class="fl">.99</span>], [<span class="fl">.1</span>, <span class="fl">.1</span>, <span class="fl">.999</span>]]</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>functions <span class="op">=</span> {<span class="st">'Arithmetic mean'</span>: mean,</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Geometric mean'</span>: gmean,</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Harmonic mean'</span>: hmean}</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> []</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> example <span class="kw">in</span> example_list:</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    table.append([np.array2string(np.array(example))])</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    table[<span class="op">-</span><span class="dv">1</span>].extend([<span class="ss">f'</span><span class="sc">{</span>f(example)<span class="sc">:.2f}</span><span class="ss">'</span> <span class="cf">for</span> f <span class="kw">in</span> functions.values()])</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>headers <span class="op">=</span> [<span class="st">'Probabilities'</span>]</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>headers.extend(<span class="bu">list</span>(functions.keys()))</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>Markdown(tabulate(table, headers<span class="op">=</span>headers))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="9">
<div id="tbl-prob-mean" class="anchored">
<table class="table table-sm table-striped">
<caption>Table&nbsp;1: Example of probability means</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Probabilities</th>
<th style="text-align: right;">Arithmetic mean</th>
<th style="text-align: right;">Geometric mean</th>
<th style="text-align: right;">Harmonic mean</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">[0.1 0.1]</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">[0.5 0.5]</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">[0.1 0.9]</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.18</td>
</tr>
<tr class="even">
<td style="text-align: left;">[0.1 0.1 0.9]</td>
<td style="text-align: right;">0.37</td>
<td style="text-align: right;">0.32</td>
<td style="text-align: right;">0.14</td>
</tr>
<tr class="odd">
<td style="text-align: left;">[0.1 0.1 0.99]</td>
<td style="text-align: right;">0.4</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">0.14</td>
</tr>
<tr class="even">
<td style="text-align: left;">[0.1 0.1 0.999]</td>
<td style="text-align: right;">0.4</td>
<td style="text-align: right;">0.7</td>
<td style="text-align: right;">0.14</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="optimal-decisions-i" class="level2">
<h2 class="anchored" data-anchor-id="optimal-decisions-i">Optimal decisions I</h2>
<p>Denote the cost of predicting class <span class="math inline">j</span> for an instance of true class <span class="math inline">i</span> as <span class="math inline">C(\hat{Y}=j|Y=i)</span>. The expected cost of predicting class <span class="math inline">j</span> for instance <span class="math inline">x</span> is</p>
<p><span class="math display">
C(\hat{Y}=j|X=x) = \sum_i P(Y=i|X=x)C(\hat{Y}=j|Y=i)
</span></p>
<p>where <span class="math inline">P(Y=i|X=x)</span> is the probability of instance <span class="math inline">x</span> having true class <span class="math inline">i</span> (as would be given by the Bayes-optimal classifier).</p>
<p>The optimal decision is then to predict the class with lowest expected cost:</p>
<p><span class="math display">
\hat{Y}^* = \mathop{\mathrm{argmin}}_j C(\hat{Y}=j|X=x) = \mathop{\mathrm{argmin}}_j \sum_i P(Y=i|X=x)C(\hat{Y}=j|Y=i)
</span></p>
</section>
<section id="optimal-decisions-ii" class="level2">
<h2 class="anchored" data-anchor-id="optimal-decisions-ii">Optimal decisions II</h2>
<p>In binary classification we have:</p>
<p><span class="math display">\begin{align*}
C(\hat{Y}=+|X=x) &amp;= P(+|x)C(+|+) + \big(1-P(+|x)\big)C(+|-) \\
C(\hat{Y}=-|X=x) &amp;= P(+|x)C(-|+) + \big(1-P(+|x)\big)C(-|-)
\end{align*}</span></p>
<p>On the optimal decision boundary these two expected costs are equal, which gives</p>
<p><span class="math display">\begin{align*}%\label{eq::cost-threshold}
P(+|x)  = \frac{\textcolor{blue}{C(+|-)-C(-|-)}}{\textcolor{blue}{C(+|-)-C(-|-)}+\textcolor{red}{C(-|+)-C(+|+)}} \triangleq c
\end{align*}</span></p>
<p>This gives the optimal threshold on the hypothetical Bayes-optimal probabilities.</p>
<p>It is also the best thing to do in practice – as long as the probabilities are well-calibrated!</p>
</section>
<section id="optimal-decisions-iii" class="level2">
<h2 class="anchored" data-anchor-id="optimal-decisions-iii">Optimal decisions III</h2>
<p>Without loss of generality we can set the cost of true positives and true negatives to zero; <span class="math inline">c = \frac{c_{\text{FP}}}{c_{\text{FP}} + c_{\text{FN}}}</span> is then the cost of a false positive in proportion to the combined cost of one false positive and one false negative.</p>
<ul>
<li>E.g., if false positives are 4 times as costly as false negatives then we set the decision threshold to <span class="math inline">4/(4+1)=0.8</span> in order to only make positive predictions if we’re pretty certain.</li>
</ul>
<p>Similar reasoning applies to changes in class priors:</p>
<ul>
<li>if we trained on balanced classes but want to deploy with 4 times as many positives compared to negatives, we lower the decision threshold to <span class="math inline">0.2</span>;</li>
<li>more generally, if we trained for class ratio <span class="math inline">r</span> and deploy for class ratio <span class="math inline">r'</span> we set the decision threshold to <span class="math inline">r/(r+r')</span>.</li>
</ul>
<p>Cost and class prior changes can be combined in the obvious way.</p>
</section>
<section id="questions-and-answers-1" class="level2">
<h2 class="anchored" data-anchor-id="questions-and-answers-1">Questions and answers</h2>
<section id="qa-1-1" class="level3">
<h3 class="anchored" data-anchor-id="qa-1-1">Q&amp;A 1</h3>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Question 1
</div>
</div>
<div class="callout-body-container callout-body">
<p>Is it possible to compute optimal risks given a cost matrix and a probabilistic classifier that is not calibrated?</p>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-21-contents" aria-controls="callout-21" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: Yes
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-21" class="callout-21-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Incorrect</strong>. Try another answer.</p>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-22-contents" aria-controls="callout-22" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: No
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-22" class="callout-22-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Correct</strong>.</p>
</div>
</div>
</div>
</section>
<section id="qa-2-1" class="level3">
<h3 class="anchored" data-anchor-id="qa-2-1">Q&amp;A 2</h3>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Question
</div>
</div>
<div class="callout-body-container callout-body">
<p>Given a calibrated probabilistic classifier, is it optimal to select the class with the highest predicted probability?</p>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-24-contents" aria-controls="callout-24" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: Yes
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-24" class="callout-24-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Incorrect</strong>. Try another answer.</p>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-25-contents" aria-controls="callout-25" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: No
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-25" class="callout-25-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Correct</strong>.</p>
</div>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Question
</div>
</div>
<div class="callout-body-container callout-body">
<p>If we have the following cost matrix, and a model outputs 0.6 probability for class 1. What would be the expected cost of predicting class 2?</p>
</div>
</div>
<div class="cell" data-execution_count="10">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tabulate <span class="im">import</span> tabulate</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Markdown</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>cost_matrix <span class="op">=</span> [[<span class="op">-</span><span class="dv">1</span>,  <span class="dv">2</span>],</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>               [ <span class="dv">4</span>, <span class="op">-</span><span class="dv">2</span>]]</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> [[<span class="st">'Predicted Class 1'</span>],</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>         [<span class="st">'Predicted Class 2'</span>]]</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, c <span class="kw">in</span> <span class="bu">enumerate</span>(cost_matrix):</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    table[i].extend(c)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>headers <span class="op">=</span> [<span class="st">'True Class 1'</span>, <span class="st">'True Class 2'</span>]</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>Markdown(tabulate(table, headers<span class="op">=</span>headers))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="10">
<div id="tbl-q-cm" class="anchored">
<table class="table table-sm table-striped">
<caption>Table&nbsp;2: Example of a cost matrix</caption>
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">True Class 1</th>
<th style="text-align: right;">True Class 2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Predicted Class 1</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td>Predicted Class 2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">-2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-27-contents" aria-controls="callout-27" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: 0.4
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-27" class="callout-27-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Incorrect</strong>. Try another answer.</p>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-28-contents" aria-controls="callout-28" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: -0.4
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-28" class="callout-28-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Incorrect</strong>. Try another answer.</p>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-29-contents" aria-controls="callout-29" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: 1.6
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-29" class="callout-29-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Correct</strong>. <span class="math inline">4*0.6 - 2*0.4</span></p>
</div>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Question
</div>
</div>
<div class="callout-body-container callout-body">
<p>What would be the expected cost of predicting class 1?</p>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-31-contents" aria-controls="callout-31" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: 0.4
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-31" class="callout-31-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Incorrect</strong>. Try another answer.</p>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-32-contents" aria-controls="callout-32" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: -0.4
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-32" class="callout-32-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Correct</strong>. <span class="math inline">-1*0.6 + 2*0.4</span></p>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-33-contents" aria-controls="callout-33" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: 1.6
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-33" class="callout-33-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Incorrect</strong>. Try another answer.</p>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="common-sources-of-miscalibration" class="level1">
<h1>Common sources of miscalibration</h1>
<iframe allowfullscreen="" src="https://media.upv.es/player/embed.html?id=543b2f90-bf2a-11ed-b716-77ee466eb043" style="border:0px #FFFFFF none;" name="Paella Player" scrolling="no" frameborder="0" marginheight="0px" marginwidth="0px" width="640" height="360">
</iframe>
<section id="common-sources-of-miscalibration-1" class="level2">
<h2 class="anchored" data-anchor-id="common-sources-of-miscalibration-1">Common sources of miscalibration</h2>
<dl>
<dt>Underconfidence:</dt>
<dd>
<p>a classifier thinks it’s <strong>worse</strong> at separating classes than it actually is.</p>
<ul>
<li>Hence we need to <em>pull predicted probabilities away from the centre</em>.</li>
</ul>
</dd>
<dt>Overconfidence:</dt>
<dd>
<p>a classifier thinks it’s <strong>better</strong> at separating classes than it actually is.</p>
<ul>
<li>Hence we need to <em>push predicted probabilities toward the centre</em>.</li>
</ul>
</dd>
</dl>
<p>A classifier can be overconfident for one class and underconfident for the other, in which case all predicted probabilities need to be increased or decreased.</p>
</section>
<section id="underconfidence-example" class="level2">
<h2 class="anchored" data-anchor-id="underconfidence-example">Underconfidence example</h2>
<div class="columns v-center-container">
<div class="column" style="width:70%;">
<ul>
<li>Underconfidence typically gives distortions.</li>
<li>To calibrate these means to .</li>
</ul>
</div><div class="column" style="width:30%;">
<p><img src="images/Underconfidence.png" class="img-fluid"></p>
<p>Source: <span class="citation" data-cites="niculescu-mizil2005">(<a href="#ref-niculescu-mizil2005" role="doc-biblioref">Niculescu-Mizil and Caruana 2005</a>)</span></p>
</div>
</div>
</section>
<section id="overconfidence-example" class="level2">
<h2 class="anchored" data-anchor-id="overconfidence-example">Overconfidence example</h2>
<div class="columns v-center-container">
<div class="column" style="width:70%;">
<ul>
<li>Overconfidence is very common, and usually a consequence of over-counting evidence. %\(e.g.&nbsp;naive Bayes, some forms of boosting).</li>
<li>Here, distortions are </li>
<li>Calibrating these means to .</li>
</ul>
</div><div class="column" style="width:30%;">
<p><img src="images/Overconfidence.png" class="img-fluid"></p>
<p>Source: <span class="citation" data-cites="niculescu-mizil2005">(<a href="#ref-niculescu-mizil2005" role="doc-biblioref">Niculescu-Mizil and Caruana 2005</a>)</span></p>
</div>
</div>
</section>
<section id="why-fitting-the-distortions-helps-with-calibration" class="level2">
<h2 class="anchored" data-anchor-id="why-fitting-the-distortions-helps-with-calibration">Why fitting the distortions helps with calibration</h2>
<div class="columns v-center-container">
<div class="column" style="width:50%;">
<p>In clockwise direction, the dotted arrows show:</p>
<ol type="1">
<li>using a point’s uncalibrated score on the <span class="math inline">x</span>-axis as input to the calibration map,</li>
<li>mapping the resulting output back to the diagonal, and</li>
<li>combine with the empirical probability of the point we started from.</li>
</ol>
<p>The closer the original point is to the fitted calibration map, the closer the calibrated point (in red) will be to the diagonal.</p>
</div><div class="column" style="width:50%;">
<p><img src="images/caruana_fig_3.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="questions-and-answers-2" class="level2">
<h2 class="anchored" data-anchor-id="questions-and-answers-2">Questions and answers</h2>
<section id="qa-1-2" class="level3">
<h3 class="anchored" data-anchor-id="qa-1-2">Q&amp;A 1</h3>
<div class="columns v-center-container">
<div class="column" style="width:50%;">
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Question
</div>
</div>
<div class="callout-body-container callout-body">
<p>The following figures show the reliability diagram of several binary classifiers. Assuming that there are enough samples on each bin, indicate if the model seems calibrated, over-confident or under-confident.</p>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-35-contents" aria-controls="callout-35" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: Calibrated.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-35" class="callout-35-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Incorrect</strong>. Try another answer.</p>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-36-contents" aria-controls="callout-36" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: Over-confident.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-36" class="callout-36-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Correct</strong>.</p>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-37-contents" aria-controls="callout-37" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: Under-confident.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-37" class="callout-37-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Incorrect</strong>. Try another answer.</p>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-execution_count="11">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pycalib.visualisations <span class="im">import</span> plot_reliability_diagram_precomputed</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span>    np.array([<span class="fl">0.</span>, <span class="fl">.1</span>, <span class="fl">.3</span>, <span class="fl">.4</span>, <span class="fl">.7</span>, <span class="fl">.9</span>, <span class="fl">1.</span>]).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>empirical <span class="op">=</span> np.array([<span class="fl">.1</span>, <span class="fl">.2</span>, <span class="fl">.4</span>, <span class="fl">.5</span>, <span class="fl">.6</span>, <span class="fl">.8</span>, <span class="fl">.9</span>]).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">4</span>))</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plot_reliability_diagram_precomputed(avg_true<span class="op">=</span>empirical, avg_pred<span class="op">=</span>scores,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                               class_names<span class="op">=</span>[<span class="st">'rain'</span>],</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                               fig<span class="op">=</span>fig, show_gaps<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="calibration_files/figure-html/cell-12-output-1.png" width="439" height="361"></p>
</div>
</div>
</div>
</div>
</section>
<section id="qa-2-2" class="level3">
<h3 class="anchored" data-anchor-id="qa-2-2">Q&amp;A 2</h3>
<div class="columns v-center-container">
<div class="column" style="width:50%;">
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-38-contents" aria-controls="callout-38" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: Calibrated.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-38" class="callout-38-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Correct</strong>.</p>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-39-contents" aria-controls="callout-39" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: Over-confident.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-39" class="callout-39-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Incorrect</strong>. Try another answer.</p>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-40-contents" aria-controls="callout-40" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: Under-confident.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-40" class="callout-40-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Incorrect</strong>. Try another answer.</p>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-execution_count="12">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pycalib.visualisations <span class="im">import</span> plot_reliability_diagram_precomputed</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="fl">.1</span>, <span class="fl">.2</span>, <span class="fl">.3</span>, <span class="fl">.4</span>, <span class="fl">.5</span>, <span class="fl">.6</span>, <span class="fl">.7</span>, <span class="fl">.8</span>, <span class="fl">.9</span>, <span class="dv">1</span>]).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>empirical <span class="op">=</span> scores</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">4</span>))</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plot_reliability_diagram_precomputed(avg_true<span class="op">=</span>empirical, avg_pred<span class="op">=</span>scores,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                               class_names<span class="op">=</span>[<span class="st">'rain'</span>],</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>                               fig<span class="op">=</span>fig, show_gaps<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="calibration_files/figure-html/cell-13-output-1.png" width="439" height="361"></p>
</div>
</div>
</div>
</div>
</section>
<section id="qa-3-1" class="level3">
<h3 class="anchored" data-anchor-id="qa-3-1">Q&amp;A 3</h3>
<div class="columns v-center-container">
<div class="column" style="width:50%;">
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-41-contents" aria-controls="callout-41" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: Calibrated.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-41" class="callout-41-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Incorrect</strong>. Try another answer.</p>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-42-contents" aria-controls="callout-42" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: Over-confident.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-42" class="callout-42-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Incorrect</strong>. Try another answer.</p>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-43-contents" aria-controls="callout-43" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: Under-confident.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-43" class="callout-43-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Correct</strong>.</p>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-execution_count="13">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pycalib.visualisations <span class="im">import</span> plot_reliability_diagram_precomputed</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span>    np.array([<span class="fl">.1</span>, <span class="fl">.3</span>, <span class="fl">.5</span>, <span class="fl">.6</span>, <span class="fl">.8</span>, <span class="fl">.9</span>]).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>empirical <span class="op">=</span> np.array([<span class="fl">0.</span>, <span class="fl">.2</span>, <span class="fl">.5</span>, <span class="fl">.7</span>, <span class="fl">.9</span>, <span class="fl">1.</span>]).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">4</span>))</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plot_reliability_diagram_precomputed(avg_true<span class="op">=</span>empirical, avg_pred<span class="op">=</span>scores,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>                               class_names<span class="op">=</span>[<span class="st">'rain'</span>],</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>                               fig<span class="op">=</span>fig, show_gaps<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="calibration_files/figure-html/cell-14-output-1.png" width="439" height="361"></p>
</div>
</div>
</div>
</div>
</section>
<section id="qa-4-1" class="level3">
<h3 class="anchored" data-anchor-id="qa-4-1">Q&amp;A 4</h3>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Question
</div>
</div>
<div class="callout-body-container callout-body">
<p>Can a binary classifier show a calibrated reliability diagram with a number of equally distributed bins, and a non-calibrated one with a higher number of equally distributed bins?</p>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-45-contents" aria-controls="callout-45" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: Yes.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-45" class="callout-45-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Correct</strong>.</p>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-46-contents" aria-controls="callout-46" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: No.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-46" class="callout-46-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Incorrect</strong>. Try another answer.</p>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="a-first-look-at-some-calibration-techniques" class="level1">
<h1>A first look at some calibration techniques</h1>
<iframe allowfullscreen="" src="https://media.upv.es/player/embed.html?id=6f5e0e00-bf2a-11ed-b716-77ee466eb043" style="border:0px #FFFFFF none;" name="Paella Player" scrolling="no" frameborder="0" marginheight="0px" marginwidth="0px" width="640" height="360">
</iframe>
<section id="a-first-look-at-some-calibration-techniques-1" class="level2">
<h2 class="anchored" data-anchor-id="a-first-look-at-some-calibration-techniques-1">A first look at some calibration techniques</h2>
<ul>
<li><strong>Parametric</strong> calibration involves modelling the score distributions within each class. \
<ul>
<li><strong>Platt scaling</strong> = Logistic calibration can be derived by assuming that the scores within both classes are normally distributed with the same variance <span class="citation" data-cites="platt2000">(<a href="#ref-platt2000" role="doc-biblioref">Platt 2000</a>)</span>.</li>
<li><strong>Beta calibration</strong> employs Beta distributions instead, to deal with scores already on a <span class="math inline">[0,1]</span> scale <span class="citation" data-cites="kull2017">(<a href="#ref-kull2017" role="doc-biblioref">Kull, Silva Filho, and Flach 2017</a>})</span>.</li>
<li><strong>Dirichlet calibration</strong> for more than two classes <span class="citation" data-cites="kull2019">(<a href="#ref-kull2019" role="doc-biblioref">Kull et al. 2019</a>)</span>.</li>
</ul></li>
<li><strong>Non-parametric</strong> calibration often ignores scores and employs ranks instead. \
<ul>
<li>E.g., <strong>isotonic regression</strong> = pool adjacent violators = ROC convex hull <span class="citation" data-cites="zadrozny2001">(<a href="#ref-zadrozny2001" role="doc-biblioref">Zadrozny and Elkan 2001</a>)</span> <span class="citation" data-cites="fawcett2007">(<a href="#ref-fawcett2007" role="doc-biblioref">Fawcett and Niculescu-Mizil 2007</a>)</span>.</li>
</ul></li>
</ul>
</section>
<section id="platt-scaling" class="level2">
<h2 class="anchored" data-anchor-id="platt-scaling">Platt scaling</h2>
<p><img src="images/Logistic.png" class="img-fluid"></p>
<p><span class="math display">\begin{align*}
    p(s; w, m) &amp;= \frac{1}{1+\exp(-w(s-m))}\\
    w &amp;= (\mu_{\textit{pos}}-\mu_{\textit{neg}})/\sigma^2,
    m = (\mu_{\textit{pos}}+\mu_{\textit{neg}})/2
\end{align*}</span></p>
</section>
<section id="beta-calibration" class="level2">
<h2 class="anchored" data-anchor-id="beta-calibration">Beta calibration</h2>
<p><img src="images/Beta.png" class="img-fluid"></p>
<p><span class="math display">\begin{align*}
  p(s; a, b, c) &amp;= \frac{1}{1+\exp(-a \ln s - b \ln (1-s) - c)} \\
  a &amp;= \alpha_{\textit{pos}}-\alpha_{\textit{neg}},
  b = \beta_{\textit{neg}}-\beta_{\textit{pos}}
\end{align*}</span></p>
</section>
<section id="isotonic-regression" class="level2">
<h2 class="anchored" data-anchor-id="isotonic-regression">Isotonic regression</h2>
<div class="columns v-center-container">
<div class="column" style="width:40%;">
<p><img src="images/ROCCH.png" class="img-fluid"></p>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:47%;">
<p><img src="images/ROCcal2.png" class="img-fluid"></p>
<p>Source: <span class="citation" data-cites="flach2016roc">Flach (<a href="#ref-flach2016roc" role="doc-biblioref">2016</a>)</span></p>
</div>
</div>
</section>
<section id="questions-and-answers-3" class="level2">
<h2 class="anchored" data-anchor-id="questions-and-answers-3">Questions and answers</h2>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Question
</div>
</div>
<div class="callout-body-container callout-body">
<p>Can a binary classifier show a calibrated reliability diagram with a number of equally distributed bins, and a non-calibrated one with a higher number of equally distributed bins?</p>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-48-contents" aria-controls="callout-48" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: What is a calibration map?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-48" class="callout-48-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>It is a mapping between the scores to be calibrated and the objective probabilities.</p>
</div>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Can Platt scaling calibrate models that are overconfident?
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-50-contents" aria-controls="callout-50" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: Yes.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-50" class="callout-50-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Incorrect</strong>. Try another answer.</p>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-51-contents" aria-controls="callout-51" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: No.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-51" class="callout-51-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Correct</strong>. Platt scaling can only generate S shaped calibration maps, which can only calibrate under-confident scores.</p>
</div>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Is isotonic regression a parametric method?
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-53-contents" aria-controls="callout-53" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: Yes.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-53" class="callout-53-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Incorrect</strong>. Try another answer.</p>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-54-contents" aria-controls="callout-54" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: No.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-54" class="callout-54-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Correct</strong>.</p>
</div>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Can Platt scaling learn an identity function if the model is already calibrated?
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-56-contents" aria-controls="callout-56" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: Yes.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-56" class="callout-56-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Incorrect</strong>. Try another answer.</p>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-57-contents" aria-controls="callout-57" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: No.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-57" class="callout-57-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Correct</strong>. Platt scaling can only learn S shaped functions, and the identity function requires a straight line.</p>
</div>
</div>
</div>
</section>
</section>
<section id="calibrating-multi-class-classifiers" class="level1">
<h1>Calibrating multi-class classifiers</h1>
<iframe allowfullscreen="" src="https://media.upv.es/player/embed.html?id=8f343b50-bf2a-11ed-83a4-bf04f88f22c5" style="border:0px #FFFFFF none;" name="Paella Player" scrolling="no" frameborder="0" marginheight="0px" marginwidth="0px" width="640" height="360">
</iframe>
<section id="whats-so-special-about-multi-class-calibration" class="level2">
<h2 class="anchored" data-anchor-id="whats-so-special-about-multi-class-calibration">What’s so special about multi-class calibration?</h2>
<p>Similar to classification, some methods are inherently multi-class but most are not.</p>
<p>This leads to (at least) three different ways of <strong>defining</strong> what it means to be fully multiclass-calibrated. - Many recent papers use the (weak) notion of confidence calibration.</p>
<p><strong>Evaluating</strong> multi-class calibration is in its full generality still an open problem.</p>
</section>
<section id="definitions-of-calibration-for-more-than-two-classes" class="level2">
<h2 class="anchored" data-anchor-id="definitions-of-calibration-for-more-than-two-classes">Definitions of calibration for more than two classes</h2>
<p>The following definitions of calibration are equivalent for binary classification but increasingly stronger for more than two classes:</p>
<ul>
<li><strong>Confidence calibration:</strong> only consider the highest predicted probability.</li>
<li><strong>Class-wise calibration:</strong> only consider marginal probabilities.</li>
<li><strong>Multi-class calibration:</strong> consider the entire vector of predicted probabilities.</li>
</ul>
</section>
<section id="confidence-calibration" class="level2">
<h2 class="anchored" data-anchor-id="confidence-calibration">Confidence calibration</h2>
<p>This was proposed by <span class="citation" data-cites="guo2017">Guo et al. (<a href="#ref-guo2017" role="doc-biblioref">2017</a>)</span>, requiring that among all instances where the probability of <strong>the most likely class</strong> is predicted to be <span class="math inline">c</span>, the expected accuracy is <span class="math inline">c</span>. (We call this `confidence calibration’ to distinguish it from the stronger notions of calibration.)</p>
<p>Formally, a probabilistic classifier <span class="math inline">\mathbf{\hat{p}}:\mathcal{X}\to\Delta_{k}</span> is <strong>confidence-calibrated</strong>, if for any confidence level <span class="math inline">c\in[0,1]</span>, the actual proportion of the predicted class, among all possible instances <span class="math inline">\mathbf{x}</span> being predicted this class with confidence <span class="math inline">c</span>, is equal to <span class="math inline">c</span>:</p>
<p><span class="math display">\begin{align*}
P(Y=i \: | \: \hat{p}_i(\mathbf{x})=c)=c\qquad\text{where }\ i=\mathop{\mathrm{argmax}}_j \hat{p}_j(\mathbf{x}).
%P\Big(Y=\argmax\big(\vph(X)\big) \: \Big| \: \max\big(\vph(X)\big)=c\Big)=c.
\end{align*}</span></p>
</section>
<section id="class-wise-calibration" class="level2">
<h2 class="anchored" data-anchor-id="class-wise-calibration">Class-wise calibration</h2>
<p>Originally proposed by <span class="citation" data-cites="zadrozny2002">Zadrozny and Elkan (<a href="#ref-zadrozny2002" role="doc-biblioref">2002</a>)</span>, this requires that all <strong>one-vs-rest</strong> probability estimators obtained from the original multiclass model are calibrated.</p>
<p>Formally, a probabilistic classifier <span class="math inline">\mathbf{\hat{p}}:\mathcal{X}\to\Delta_{k}</span> is <strong>classwise-calibrated</strong>, if for any class <span class="math inline">i</span> and any predicted probability <span class="math inline">q_i</span> for this class, the actual proportion of class <span class="math inline">i</span>, among all possible instances <span class="math inline">\mathbf{x}</span> getting the same prediction <span class="math inline">\hat{p}_i(\mathbf{x})=q_i</span>, is equal to <span class="math inline">q_i</span>:</p>
<p><span class="math display">\begin{align*}
P(Y=i\mid \hat{p}_i(\mathbf{x})=q_i)=q_i\qquad\text{for }\ i=1,\dots,k.
\end{align*}</span></p>
</section>
<section id="multi-class-calibration" class="level2">
<h2 class="anchored" data-anchor-id="multi-class-calibration">Multi-class calibration</h2>
<p>This is the <strong>strongest form of calibration</strong> for multiple classes, subsuming the previous two definitions.</p>
<p>A probabilistic classifier <span class="math inline">\mathbf{\hat{p}}:\mathcal{X}\to\Delta_{k}</span> is <strong>multiclass-calibrated</strong> if for any prediction vector <span class="math inline">\mathbf{q}=(q_1,\dots,q_k)\in\Delta_{k}</span>, the proportions of classes among all possible instances <span class="math inline">\mathbf{x}</span> getting the same prediction <span class="math inline">\mathbf{\hat{p}}(\mathbf{x})=\mathbf{q}</span> are equal to the prediction vector <span class="math inline">\mathbf{q}</span>:<br>
<span class="math display">\begin{align*} %\label{eq:calib}
P(Y=i\mid \mathbf{\hat{p}}(\mathbf{x})=\mathbf{q})=q_i\qquad\text{for }\ i=1,\dots,k.
\end{align*}</span></p>
</section>
<section id="reminder-binning-needed" class="level2">
<h2 class="anchored" data-anchor-id="reminder-binning-needed">Reminder: binning needed</h2>
<p>For practical purposes, the conditions in these definitions need to be relaxed. This is where <strong>binning</strong> comes in.</p>
<p>Once we have the bins, we can draw a <strong>reliability diagram</strong> as in the two-class case. For class-wise calibration, we can show per-class reliability diagrams or a single averaged one.</p>
<p>The degree of calibration is assessed using the <strong>gaps</strong> in the reliability diagram. All of this will be elaborated in the next part of the tutorial.</p>
</section>
<section id="important-points-to-remember" class="level2">
<h2 class="anchored" data-anchor-id="important-points-to-remember">Important points to remember</h2>
<ul>
<li><strong>Only well-calibrated probability estimates are worthy to be called probabilities:</strong> otherwise they are just scores that happen to be in the <span class="math inline">[0,1]</span> range.</li>
<li><strong>Binning will be required in some form:</strong> instance-based probability evaluation metrics such as Brier score or log-loss always measure calibration <strong>plus something else</strong>.</li>
<li><strong>In multi-class settings, think carefully about which form of calibration you need:</strong> e.g., confidence-calibration is too weak in a cost-sensitive setting.</li>
</ul>
</section>
<section id="questions-and-answers-4" class="level2">
<h2 class="anchored" data-anchor-id="questions-and-answers-4">Questions and answers</h2>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Can we interpret the output of any model that produces values between zero and
</div>
</div>
<div class="callout-body-container callout-body">
<p>one as probabilities?</p>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-59-contents" aria-controls="callout-59" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: Yes.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-59" class="callout-59-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Incorrect</strong>. Try another answer.</p>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-60-contents" aria-controls="callout-60" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: No.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-60" class="callout-60-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Correct</strong>. Some models have been trained to generate values in any arbitrary range, but this does not mean that the model is predicting actual probabilities.</p>
</div>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Question
</div>
</div>
<div class="callout-body-container callout-body">
<p>Is there only one way to measure calibration for multiclass probability scores.</p>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-62-contents" aria-controls="callout-62" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: Yes.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-62" class="callout-62-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Incorrect</strong>. Try another answer.</p>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-63-contents" aria-controls="callout-63" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: No.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-63" class="callout-63-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Correct</strong>. There are multiple measures of calibration.</p>
</div>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Question
</div>
</div>
<div class="callout-body-container callout-body">
<p>Can we perform optimal decisions in a multiclass setting by knowing the highest probability among the classes and the misclassification costs?</p>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-65-contents" aria-controls="callout-65" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: Yes.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-65" class="callout-65-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Incorrect</strong>. Try another answer.</p>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-66-contents" aria-controls="callout-66" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: No.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-66" class="callout-66-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Correct</strong>. We need the probabilities of every class in order to make an optimal decision.</p>
</div>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Question
</div>
</div>
<div class="callout-body-container callout-body">
<p>If the data distribution, operating conditions and the missclassification costs do not change from training to test set, and a model makes optimal predictions in the training set. Do we need the exact probabilities in the test set to make optimal decisions?</p>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-68-contents" aria-controls="callout-68" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: Yes.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-68" class="callout-68-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Incorrect</strong>. Try another answer.</p>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-69-contents" aria-controls="callout-69" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Answer: No.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-69" class="callout-69-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Correct</strong>.</p>
</div>
</div>
</div>
</section>
</section>
<section id="references" class="level1">




</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-brier1950" class="csl-entry" role="doc-biblioentry">
Brier, Glenn W. 1950. <span>“<span class="nocase">Verification of forecasts expressed in terms of probabilities</span>.”</span> <em>Monthly Weather Review</em> 78 (1): 1–3.
</div>
<div id="ref-fawcett2007" class="csl-entry" role="doc-biblioentry">
Fawcett, Tom, and Alexandru Niculescu-Mizil. 2007. <span>“<span class="nocase">PAV and the ROC convex hull</span>.”</span> <em>Machine Learning</em> 68 (1): 97–106.
</div>
<div id="ref-flach2016roc" class="csl-entry" role="doc-biblioentry">
Flach, Peter A. 2016. <span>“<span>ROC</span> Analysis.”</span> In <em>Encyclopedia of Machine Learning and Data Mining</em>. Springer.
</div>
<div id="ref-guo2017" class="csl-entry" role="doc-biblioentry">
Guo, Chuan, Geoff Pleiss, Yu Sun, and Kilian Q Weinberger. 2017. <span>“<span class="nocase">On Calibration of Modern Neural Networks</span>.”</span> In <em>34th International Conference on Machine Learning</em>, 1321–30.
</div>
<div id="ref-kull2019" class="csl-entry" role="doc-biblioentry">
Kull, Meelis, Miquel Perello-Nieto, Markus Kängsepp, Telmo Silva Filho, Hao Song, and Peter Flach. 2019. <span>“<span class="nocase">Beyond temperature scaling: Obtaining well-calibrated multiclass probabilities with Dirichlet calibration</span>.”</span> In <em>Advances in Neural Information Processing Systems (NIPS’19)</em>, 12316–26.
</div>
<div id="ref-kull2017" class="csl-entry" role="doc-biblioentry">
Kull, Meelis, Telmo M. Silva Filho, and Peter Flach. 2017. <span>“<span class="nocase">Beyond Sigmoids: How to obtain well-calibrated probabilities from binary classifiers with beta calibration</span>.”</span> <em>Electronic Journal of Statistics</em> 11 (2): 5052–80.
</div>
<div id="ref-niculescu-mizil2005" class="csl-entry" role="doc-biblioentry">
Niculescu-Mizil, Alexandru, and Rich Caruana. 2005. <span>“<span class="nocase">Predicting good probabilities with supervised learning</span>.”</span> In <em>22nd International Conference on Machine Learning (ICML’05)</em>, 625–32. ACM Press.
</div>
<div id="ref-platt2000" class="csl-entry" role="doc-biblioentry">
Platt, JC. 2000. <span>“<span class="nocase">Probabilities for SV Machines</span>.”</span> In <em>Advances in Large-Margin Classifiers</em>, edited by Alexander J. Smola, Peter Bartlett, Bernhard Schölkopf, and Dale Schuurmans, 61—–74. MIT Press.
</div>
<div id="ref-zadrozny2001" class="csl-entry" role="doc-biblioentry">
Zadrozny, Bianca, and Charles Elkan. 2001. <span>“<span class="nocase">Obtaining calibrated probability estimates from decision trees and naive Bayesian classifiers</span>.”</span> In <em>18th International Conference on Machine Learning (ICML’01)</em>, 609—–616.
</div>
<div id="ref-zadrozny2002" class="csl-entry" role="doc-biblioentry">
———. 2002. <span>“<span class="nocase">Transforming Classifier Scores into Accurate Multiclass Probability Estimates</span>.”</span> In <em>8th ACM SIGKDD International Conference on Knowledge Discovery and Data Mining - KDD ’02</em>, 694—–699. ACM Press.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2023, Miquel Perello Nieto.</div>   
    <div class="nav-footer-right">This website was built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>



</body></html>